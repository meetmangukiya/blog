<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>GSoC Phase-1 Mid&middot; Meet Mangukiya | My Blog</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Meet Mangukiya">
	<meta name="description" content="My footprint on the WE">
	
	<meta name="generator" content="Hugo 0.20.5" />

	<!-- CSS -->
	<link rel="stylesheet" href="https://meetmangukiya.github.io/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="https://meetmangukiya.github.io/favicon.ico" type="image/x-icon">

	<!-- RSS -->
	

	<!-- Font Awesome -->
	<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
    <header class="site-header">
	<div class="branding">
		<a href="https://meetmangukiya.github.io/">
		<img class="avatar" src="https://meetmangukiya.github.io/img/avatar.jpg" alt=""/>
		</a>
		<h1 class="site-title">
			<a href="https://meetmangukiya.github.io/">Meet Mangukiya | My Blog</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
	      	

	      	<li>
	<a href="https://meetmangukiya.github.io/" title="">
		<i class="fa fa-fw fa-home"></i>
	</a>
</li>

<li>
	<a href="https://meetmangukiya.github.io/index.xml" title="Subcribe">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>

<li>
	<a href="mailto:meet123mangukiya@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>











<li>
	<a href="https://github.com/meetmangukiya/" title="GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>



















<li>
	<a href="https://twitter.com/meetmangukiya98" title="Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>







<li>
	<a href="https://gitlab.com/meetmangukiya" title="Gitlab">
		<i class="fa fa-fw fa-gitlab"></i>
	</a>
</li>

	    </ul>
	</nav>
</header>


    <div class="content">
    <article>
		<header>
			<h1 class="title">GSoC Phase-1 Mid</h1>
			<p class="meta">
    June 15, 2017 &middot; 4 minute read

    
        &middot; Tags:
            <a href="https://meetmangukiya.github.io/tags/coala">coala</a>
            
</p>

		</header>

	<section class="post-content">
		

<p>The coding phase started with the first week of June. Since then:</p>

<h1 id="ported-8-plugins">Ported 8 plugins</h1>

<p>The 7 plugins ported are:</p>

<ol>
<li>explain - It returns an explanatory message for a given term.</li>
<li>ghetto</li>
<li>lmgtfy - returns a lmgtfy link with a given search string.</li>
<li>nevermind - returns a &lsquo;I&rsquo;m sorry&rsquo; message.</li>
<li>searchdocs - returns a link to relevant search page.</li>
<li>ship-it - returns motivational squirrel images.</li>
<li>the-rules - returns bot rules</li>
</ol>

<h2 id="some-things-about-testing-in-errbot">Some things about testing in errbot</h2>

<p>All of these 7 plugins were pretty simple to implement. Also, there is a policy
of 100% test coverage in the corobo repository. So, all the plugins are tested
as well. Testing is actually an interesting part. Actually the testing statement
is pretty simple <code>self.assertCommand('!message that is a command', 'expected
output of the command.')</code>. But there&rsquo;s a lot going on in here.</p>

<p>First of all, here the <code>self</code> is actually the instance of a stub of errbot.
A stub is a minimal working substitution of an object, usually created and used
in testing.</p>

<p>Fortunately, the stub is available from errbot itself. There is a pytest fixture
that can be used to get the stub in your testing function, or you can yourself
instantiate the <code>TestBot</code> class appropriately. If you use the fixture, then that
part is handled by the fixture itself implicitly :D.</p>

<p>Rough flow is:</p>

<ol>
<li>Instantiate the bot.</li>
<li>Bot collects the plugins.</li>
<li>Bot instantiates the plugins.</li>
<li>The plugins are activated. (You can override <code>activate</code> method to perform
do something during <code>activation</code>).</li>
<li>After the plugin is activated, bot registers the commands and calls the appropriate command based on whether it is a normal cmd, or a cmd that has to be triggered if the msg matches the given regex viz. <code>re_botcmd</code>, or a callback cmd that is called on every single message.</li>
<li>Well, after the function call it is our plugin taking over and doing the processing and appropriately respond with [a] message/messages.</li>
</ol>

<h3 id="one-of-the-biggest-pitfall">One of the biggest pitfall</h3>

<p>I had to do some intensive mocking in the <code>LabHub</code> plugin(PR can be found here
<a href="https://github.com/coala/corobo/pull/71)">https://github.com/coala/corobo/pull/71)</a>, it is already +300 change and there&rsquo;s
still much stuff to add all the functionality.</p>

<p>This plugin is mainly about managing/modifying github and gitlab repositories.
Like inviting people to the org, creating issues, assigning issues, unassigning
issues, etc. Since, all of these primarily makes REST API(http requests) calls,
most of the plugin is tested using mocking the features, essentially monkey
patching the functions that make the API call and set the return value to
something sane.</p>

<p>Usually mocking is about playing with python namespaces and assignign them
appropriately.</p>

<p>So the problem that arised was:</p>

<ol>
<li>errbot uses <a href="https://github.com/tibonihoo/yapsy/">yapsy</a> for plugin management and loading. So, now, since the loading is done by some third party library it is not possible to access the namespace of the plugin, hence, it cannot be monkey patched. So, to get around this, it took me some time to find solution to this problem. I got away with a dirty workaround on this one. When one instantiates the stub viz. <code>TestBot</code> class mentioned earlier, it has the yapsy plugin manager as one of the attributes and it could be used to instantiate the plugin directly from the code, manually.</li>
</ol>

<pre><code class="language-py">from errbot.backends.test import TestBot
import plugin.ThePluginClass

# the stub
testbot = TestBot()
testbot.start()

# load and instanciate the plugin
plug = testbot.bot.plugin_manager.instanciateElement(plugin.ThePluginClass)
# activate the plugin
plug.activate()

# patch the plugin.ThePluginClass namespace for mocking
</code></pre>

<p>\2. So after I found this workaround I used it. It worked for most of the functions properly, other then the callback function. Since the callback function is registered by errbot and our plugin was manually instantiated and activated, it isn&rsquo;t registered to errbot and hence doesn&rsquo;t call the callback function.</p>

<h1 id="igitt">IGitt</h1>

<p>In last few days I started contributing to <a href="https://gitlab.com/gitmate/open-source/IGitt">IGitt</a>. I wanted to use it in the <code>LabHub</code> plugin. Since I had both GitHub and GitLab utilities to manage, IGitt was the perfect choice. It provides with a unified interface for various Git-hosting services, it is awesome, isn&rsquo;t it?</p>

<p>I implemented some small things that I needed for my plugins, and also wrote
tests for the GitHub implementation. Testing in IGitt was previously done
through doctests and making real API calls. So, we came up with idea that we
should record API requests and then reuse it, instead of making API calls on
each build. Thanks to the open-source community, there are already
things/libraries that do that. We used vcrpy for that. What vcr does is records
the http requests, with responses, headers and almost all the data in a file
which is called cassette. Then, it plays the cassettes, i.e. returns the
responses from the files to the requests made in the code. Hence, it is a <em>vcr</em>
replaying and recording http <em>cassettes</em>.</p>

<p>The review process was pretty quick, thanks to @fneu, @sils, @nkprince007 which
are almost all the contributors of IGitt ATM. Since the review process was quick
I can quickly integrate the same in my corobo plugin. It is awesome!</p>

<p>Helpful Links:</p>

<ol>
<li><a href="https://en.wikipedia.org/wiki/Monkey_patch">https://en.wikipedia.org/wiki/Monkey_patch</a></li>
<li><a href="https://en.wikipedia.org/wiki/Mock_object">https://en.wikipedia.org/wiki/Mock_object</a></li>
<li><a href="https://en.wikipedia.org/wiki/Test-driven_development">https://en.wikipedia.org/wiki/Test-driven_development</a></li>
</ol>


		
	</section>
    </div>

    <footer class="site-footer">
	<p class="text">&copy; 2017 - Released under the MIT license<br>Powered by <a href="//gohugo.io/">Hugo</a> with the <a href="//github.com/digitalcraftsman/hugo-type-theme">Type Theme</a></p>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-86162389-3', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>
